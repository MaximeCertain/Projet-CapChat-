<html>
    <head>
        <style>
                #myProgress {
                    width: 100%;
                    background-color: grey;
                  }
                  
                  #myBar {
                    width: 1%;
                    height: 30px;
                    background-color: orange;
                  }
        </style>
    </head>
<body>
        <h1 id="result"></h1>
<canvas id="canvas" width="600" height="300" onclick="onclick_page(event);" style="border:1px solid black;">
    Le canvas ne s'affiche pas
</canvas>
<h1>Cliquez sur l'image correspondante</h1>
<h1 id="question"></h1>
<button disabled=true id="btnLancement" onclick="relancer();">Lancer</button>
<div id="myProgress">
    <div id="myBar"></div>
  </div>
</body>
</html>
<script type="text/javascript" src="tableau.js"></script>
<script>
                   var widthMax = 100;
                   function decrementWidthMax() {
                       widthMax = widthMax -5;
                   }
                   function reinitWidthMax() {
                    widthMax = 100;
                }
 function load()
        {  //incrémentation tableaux 
            document.getElementById('btnLancement').disabled = false;
            move(widthMax);
    var createImage = function(src, title) {
        var img   = new Image();
        img.src   = src;
        img.alt   = title;
        img.title = title;
        return img; 
      };
      // array of images
      var imagesSingulieres = [];
      // push two images to the array

for(var r=1; r<=13; r++)
{
    imagesSingulieres.push(createImage("singuliers/" + r +".jpg", tableauQuestions[r-1]));
}

      //incrémentation tableau neutres
      var imagesNeutres = [];
      for(var k = 1; k<= 13; k++)
      {
          console.log()
        imagesNeutres.push(createImage("neutres/chat_neutre_"+k+".jpg", ""));
      }

      var imagesCapChat = [];
      
        var rand = imagesSingulieres[Math.floor(Math.random() * imagesSingulieres.length)];
        imagesCapChat.push(createImage(rand.src, rand.title));

for(var i =0; i<=6; i++)
{
    var rand = imagesNeutres[Math.floor(Math.random() * imagesNeutres.length)];
    imagesCapChat.push(createImage(rand.src, rand.title));
    var index = imagesNeutres.indexOf(rand);
    imagesNeutres.splice(index,1)
}   
var Question;
imagesCapChat.sort(function(){return 0.5-Math.random();});
for(i=0;i<imagesCapChat.length;i++) {
if(imagesCapChat[i].title != "")
{
    Question = imagesCapChat[i].title;
}
 };
        document.getElementById("question").innerHTML = Question;

    var total = 0;
    for(var i = 0; i < imagesCapChat.length; i++){
        var img = new Image();
        imagesCapChat[i].onload = function(){
            total++;
            if(total == imagesCapChat.length){
                console.log("c'est ok");
                        }
        };
    }
//https://developer.mozilla.org/fr/docs/Tutoriel_canvas/Utilisation_d'images
         var c = document.getElementById("canvas");
         var ctx = c.getContext("2d");       
         x=0;
         y=0;
         //variables de détection de l'emplacement du clic
          maxX = 0;
          minX = 0;
          maxY = 0;
          minY = 0;
    
         var img = new Image();   // Crée un nouvel élément Image
         img.addEventListener('load', function() {
            ctx.drawImage(img, x, y,150,150);
            ctx.stroke();
        }, false);
        img.src = imagesCapChat[0].src; // Définit le chemin vers sa source
        if(imagesCapChat[0].title != "")
        {
            minX = 0;
            maxX = 150;
            minY =0;
            maxY =150;
        }
         
         var img2 = new Image();   // Crée un nouvel élément Image
         img2.addEventListener('load', function() {   
            ctx.drawImage(img2, 150, y,150,150);
            ctx.stroke();
        }, false);
        img2.src = imagesCapChat[1].src; // Définit le chemin vers sa source
        if(imagesCapChat[1].title != "")
        {
            minX = 150;
            maxX = 300;
            minY =0;
            maxY =150;
        }
        var img3 = new Image();   // Crée un nouvel élément Image
        img3.addEventListener('load', function() {   
           ctx.drawImage(img3, 300, y,150,150);
           ctx.stroke();
       }, false);
       img3.src = imagesCapChat[2].src; // Définit le chemin vers sa source
       if(imagesCapChat[2].title != "")
       {
           minX = 300;
           maxX = 450;
           minY =0;
           maxY =150;
       }
       var img4 = new Image();   // Crée un nouvel élément Image
       img4.addEventListener('load', function() {   
          ctx.drawImage(img4, 450, y,150,150);
          ctx.stroke();
      }, false);
      img4.src = imagesCapChat[3].src; // Définit le chemin vers sa source
      if(imagesCapChat[3].title != "")
      {
          minX = 450;
          maxX = 600;
          minY =0;
          maxY =150;
      }
      var img5 = new Image();   // Crée un nouvel élément Image
      img5.addEventListener('load', function() {   
         ctx.drawImage(img5,  0, 150,150,150);
         ctx.stroke();
     }, false);
     img5.src = imagesCapChat[4].src; // Définit le chemin vers sa source
     if(imagesCapChat[4].title != "")
     {
         minX = 0;
         maxX = 150;
         minY =150;
         maxY =300;
     }  
     var img6 = new Image();   // Crée un nouvel élément Image
     img6.addEventListener('load', function() {   
        ctx.drawImage(img6, 150, 150,150,150);
        ctx.stroke();
    }, false);
    img6.src = imagesCapChat[5].src; // Définit le chemin vers sa source
    if(imagesCapChat[5].title != "")
    {
        minX = 150;
        maxX = 300;
        minY =150;
        maxY =300;
    }
    var img9 = new Image();   // Crée un nouvel élément Image
    img9.addEventListener('load', function() {   
       ctx.drawImage(img9, 300, 150,150,150);
       ctx.stroke();
   }, false);
   img9.src = imagesCapChat[6].src; // Définit le chemin vers sa source
   if(imagesCapChat[6].title != "")
   {
       minX = 300;
       maxX = 450;
       minY =150;
       maxY =300;   
   }

   var img8 = new Image();   // Crée un nouvel élément Image
   img8.addEventListener('load', function() {   
      ctx.drawImage(img8, 450, 150,150,150);
      ctx.stroke();
  }, false);
  img8.src = imagesCapChat[7].src; // Définit le chemin vers sa source
  if(imagesCapChat[7].title != "")
     {
         minX = 450;
         maxX = 600;
         minY =150;
         maxY =300;
     }
    }
//console.log(maxX + minX + maxY + minY);
  function onclick_page(event)
  {
    var x = event.clientX;
    var y = event.clientY;
     if(x<maxX && x> minX && y < maxY && y > minY)
        {
            document.getElementById("result").innerHTML = "Bien joué le captcha est validé";
            document.getElementById('btnLancement').disabled = false;
           // load();
        } 
        else
        {
            document.getElementById("result").innerHTML = "Dommage, veuillez réessayer (0,5 secondes de moins)";
            decrementWidthMax();
            document.getElementById("myProgress").style.width = widthMax + '%';
            console.log(widthMax);
        }
  } 
  window.onload = function() { load();
}
  function move(widthMax) {
    var elem = document.getElementById("myBar");    
    var width = 1;
    var id = setInterval(frame, widthMax);
    function frame() {
        if(document.getElementById("result").innerHTML == "Bien joué le captcha est validé")
      {
          clearInterval(id);
      }
   else if (width >= widthMax) {
    decrementWidthMax();
    document.getElementById("myProgress").style.width = widthMax + '%';
        console.log(widthMax);
        clearInterval(id);
        document.getElementById("result").innerHTML = "Il vous reste " + (widthMax/10) + " secondes ";
        load();
      }    
      else if (document.getElementById("result").innerHTML == "Dommage, veuillez réessayer (0,5 secondes de moins)")
      {
          clearInterval(id);
          document.getElementById("result").innerHTML = "Il vous reste " + (widthMax/10) + " secondes ";

      }  
      else if (document.getElementById("result").innerHTML == "Il vous restepour trouver" )
      {
          clearInterval(id);
          document.getElementById("result").innerHTML = "Il vous reste " + (widthMax/10) + " secondes ";
          load();
 
      }  
      else {
        width++; 
        elem.style.width = width + '%'; 
      }
    }
  }
   function relancer() {
    document.getElementById("result").innerHTML = "Il vous restepour trouver";
    move(widthMax);
  }
      
</script>   